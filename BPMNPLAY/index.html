<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ingreso de Jugadores</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

</head>
<body>
<div class="container">
    <div class="col">
        <form action="/tablero" method="get" onsubmit="return  verificarSiElEquipoNoSeHaConectado()">
            <div id="centro">
                <div class="form-group">
                    <label>Código partida:</label>
                    <div class="col-md-8">
                    <input type="text" class="form-control" placeholder="Código de la partida"
                           id="codigoPartida" name="codigoPartida">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-8">
                        <button type="button" class="btn" id="consultarPartida" onclick="consultarJugadores()" > Consultar Jugadores</button>
                    </div>
                </div>
                <div class="form-group" id="divTipoEquipo" hidden>
                    <label>Tipo de ingreso:</label>
                    <div class="col-md-8">
                        <select id="tipoIngreso" name="tipoIngreso" class="form-control" onchange="habilitarNombreEquipo()">
                            <option value="ninguno" >Seleccione un tipo</option>
                            <option value="jugador">Jugador</option>
                            <option value="espectador">Espectador</option>
                        </select>
                    </div>
                </div>
                <div class="form-group" id="divNombreEquipo" hidden>
                    <label >Nombre del equipo:</label>
                    <div class="col-md-8">
                        <select id="nombreEquipo" name="nombreEquipo" class="form-control" onchange="verificarDisponibilidadEquipo()">
                            <option value="ninguno" >Seleccione un nombre</option>
                        </select>
                    </div>
                </div>

            </div>
            <button type="submit" class="btn btn-primary" >Unirse a partida</button>
        </form>
    </div>
</div>
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
<script>
    var socket = io();

    socket.on('confirmacionPartida', function (data) {

        console.log("Ya recibi")

        if(data.length>0) {
            if(document.getElementById("codigoPartida").value != ""){
                document.getElementById("divTipoEquipo").removeAttribute("hidden");
                for(var i = 0; i < data.length; i++) {
                    var option = document.createElement("OPTION");
                    option.setAttribute("value",data[i].nombreEquipo);
                    var nombre = document.createTextNode(data[i].nombreEquipo)
                    option.appendChild(nombre);
                    document.getElementById("nombreEquipo").appendChild(option);
                }

            }else
            {
                document.getElementById("divTipoEquipo").setAttribute("hidden","");
            }

        }
        else {
            alert("La partida ingresada no es válida");

        }
    })

    function consultarJugadores() {
        socket.emit('verificarPartida', document.getElementById("codigoPartida").value);
console.log("Ya se envio")

    }

function habilitarNombreEquipo() {
    console.log("lklkkl"+document.getElementById("tipoIngreso").value);
    if(document.getElementById("tipoIngreso").value == "jugador"){
        document.getElementById("divNombreEquipo").removeAttribute("hidden");

    }else
    {
        document.getElementById("divNombreEquipo").setAttribute("hidden","");
    }
}

function verificarSiElEquipoNoSeHaConectado() {

    console.log("Nioooooooooooo")
    socket.emit('verificarEquipo', document.getElementById("codigoPartida").value,document.getElementById("nombreEquipo").value);
    socket.on('confirmacionEquipo', function (data) {
        if(!data)
        {
            alert("El equipo con el cual desea ingresar ya se encuentra conectado. Se sugiere ingresar como espectador");
            event.preventDefault();
            return false;

        }else {
            return true;
        }
    })


}

</script>
</body>
</html>