<!DOCTYPE html>
<html lang="en">
<head>
    <title>Ingreso de Jugadores</title>
    <% include ../parciales/head %>

</head>
<body>
<header>
    <% include ../parciales/header %>
</header>
<div class="container">
    <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-6">
            <div class="row">
                <div class="col-lg-12">
                    <img class="rounded mx-auto d-block"
                         src="https://cem.epn.edu.ec/imagenes/logos_institucionales/big_jpg/BUHO_ABSTRACCION_EPN_big.jpg"
                         height="100" width="100">
                </div>
            </div>
        </div>
        <div class="col-md-3"></div>
    </div>
    <br>
    <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-6">
            <div class="row">
                <div class="col-md-12">
                    <form id="login-form" action="#" method="post" role="form" style="display: block;">
                        <div class="row">
                            <div class="col-md-2"></div>
                            <div class="col-md-8 text-center">
                                <label for="codigoPartida">C칩digo partida:</label>
                                <input type="text" class="form-control bg-dark text-white rounded text-center" placeholder="C칩digo de la partida"
                                               id="codigoPartida" name="codigoPartida">
                            </div>
                            <div class="col-md-2"></div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-12 text-center">
                                <button type="button" class="btn btn-info" id="consultarPartida" onclick="consultarJugadores()">Verificar c칩digo partida
                                </button>
                            </div>
                        </div>
                        <br>
                        <div class="row" id="divTipoEquipo" hidden>
                            <div class="col-md-2"></div>
                            <div class="col-md-8 text-center">
                                <label for="tipoIngreso">Tipo de Ingreso:</label>
                                <select id="tipoIngreso" name="tipoIngreso" class="form-control text-center"
                                        onchange="habilitarNombreEquipo()">
                                    <option value="ninguno">Seleccione un tipo de ingreso</option>
                                    <option value="jugador">Jugador</option>
                                    <option value="espectador">Espectador</option>
                                </select>
                            </div>
                            <div class="col-md-2"></div>
                        </div>
                        <br>
                        <div class="row" id="divNombreEquipo" hidden>
                            <div class="col-md-2"></div>
                            <div class="col-md-8 text-center">
                                <label for="nombreEquipo">Nombre del Equipo:</label>
                                <select id="nombreEquipo" name="nombreEquipo" class="form-control text-center"
                                        onchange="verificarDisponibilidadEquipo()">
                                </select>
                            </div>
                            <div class="col-md-2"></div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-2"></div>
                            <div class="col-md-8 text-center">
                                <input type="button" value="Unirse a partida" class="btn btn-primary" hidden id="botonUnir" onclick="unirsePartida()">
                                <button type="submit" class="btn btn-primary" id="unirPartida" hidden></button>
                            </div>
                            <div class="col-md-2"></div>
                        </div>
                    </form>
                    <div class="row text-center">
                        <div class="col-md-2"></div>
                        <div class="col-md-8">
                            <img src="../../static/imagenes/espera.gif" id="imagenE" width="150px" hidden height="200px">
                        </div>
                        <div class="col-md-2"></div>



                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3"></div>
    </div>
</div>
<script src="/socket.io/socket.io.js"></script>

<script>
    var socket = io();
    var disponible = false;
    socket.on('confirmacionEquipo', function (data) {
        if (data == "true") {
            disponible = true;
            return false;
        } else {
            return true;
        }
    });
    socket.on('confirmacionPartida', function (data) {
        if (data.length > 0) {
            if (document.getElementById("codigoPartida").value != "") {
                document.getElementById("divTipoEquipo").removeAttribute("hidden");
                document.getElementById("nombreEquipo").innerHTML = "";
                var option1 = document.createElement("OPTION");
                option1.setAttribute("value", "ninguno");
                var nombre1 = document.createTextNode("Selecciona el equipo que representas");
                option1.appendChild(nombre1);
                document.getElementById("nombreEquipo").appendChild(option1);
                for (var i = 0; i < data.length; i++) {
                    var option = document.createElement("OPTION");
                    option.setAttribute("value", data[i].nombreEquipo);
                    var nombre = document.createTextNode(data[i].nombreEquipo);
                    option.appendChild(nombre);
                    document.getElementById("nombreEquipo").appendChild(option);
                }

            } else {
                document.getElementById("divTipoEquipo").setAttribute("hidden", "");
            }

        }
        else {
            alert("La partida ingresada no es v치lida");

        }
    });

    function consultarJugadores() {
        socket.emit('verificarPartida', document.getElementById("codigoPartida").value);
    }

    function habilitarNombreEquipo() {
        if (document.getElementById("tipoIngreso").value == "jugador") {
            document.getElementById("divNombreEquipo").removeAttribute("hidden");
            document.getElementById("botonUnir").removeAttribute("hidden");

        } else {
            document.getElementById("divNombreEquipo").setAttribute("hidden", "");
            if (document.getElementById("tipoIngreso").value == "espectador"){
                document.getElementById("botonUnir").removeAttribute("hidden");

            }else {
                document.getElementById("botonUnir").setAttribute("hidden", "");
            }
        }
    }

    function verificarDisponibilidadEquipo() {
        socket.emit('verificarEquipo', document.getElementById("codigoPartida").value, document.getElementById("nombreEquipo").value);
    }

    function unirsePartida() {
        if (document.getElementById("tipoIngreso") == "espectador") {
            //document.getElementById('unirPartida').click();
        }
        else {

            if (document.getElementById('tipoIngreso').value == "jugador") {
                if (document.getElementById('nombreEquipo').value == "ninguno") {
                    alert("Seleccione un nombre de equipo.")
                }
                else {
                    if (disponible) {
                      //  document.getElementById('unirPartida').click();
                            document.getElementById("imagenE").removeAttribute("hidden");
                        socket.emit('new player', document.getElementById('codigoPartida').value, document.getElementById('tipoIngreso').value, document.getElementById('nombreEquipo').value);
                    }
                    else {
                        document.getElementById("imagenE").setAttribute("hidden", "");
                        alert("El equipo con el cual desea ingresar ya se encuentra conectado. Se sugiere ingresar con el nombre de otro jugador o como de espectador");
                    }
                }
            }
            else
                {
                    if (document.getElementById('tipoIngreso').value == "ninguno") {
                        alert("Seleccione un tipo de ingreso a la partida");
                    }
                    else {
                        document.getElementById('unirPartida').click();
                    }

                }
            }
    }

</script>
</body>
</html>